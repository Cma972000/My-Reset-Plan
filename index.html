<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#7dd3fc">
    <title>My Reset Plan | Honest Journey</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #F8FAFC;
            --text-main: #334155;
            --text-light: #94a3b8;
            
            /* Gradients for "Alive" feel */
            --grad-morning: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%);
            --grad-afternoon: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            --grad-evening: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --grad-night: linear-gradient(135deg, #a6c0fe 0%, #f68084 100%);
            
            --success-glow: 0 0 15px rgba(134, 239, 172, 0.6);
            --card-shadow: 0 8px 20px rgba(0,0,0,0.04);
            --radius: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 160px; /* Space for sticky footer */
            overflow-x: hidden;
        }

        .app-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* --- 1. Header & Streak Badge --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-top: 10px;
        }

        .header-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            background: -webkit-linear-gradient(45deg, #334155, #64748b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-text .subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .streak-badge {
            background: white;
            padding: 8px 16px;
            border-radius: 50px;
            box-shadow: var(--card-shadow);
            font-weight: 800;
            font-size: 0.9rem;
            color: #f59e0b; /* Amber for fire */
            display: flex;
            align-items: center;
            gap: 6px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-4px); }
            100% { transform: translateY(0px); }
        }

        /* --- 2. Time Blocks with Master Checkbox --- */
        .time-block {
            margin-bottom: 35px;
            position: relative;
        }

        /* Colorful Headers */
        .block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .block-header:active { transform: scale(0.98); }

        .header-morning { background: var(--grad-morning); }
        .header-afternoon { background: var(--grad-evening); } /* Swapped for better contrast */
        .header-evening { background: var(--grad-afternoon); }
        .header-night { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        .master-check-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            backdrop-filter: blur(4px);
        }

        .master-check-label:hover { background: rgba(255,255,255,0.3); }

        /* --- Task Cards --- */
        .task-list { display: flex; flex-direction: column; gap: 12px; }

        .task-card {
            background: white;
            padding: 16px 20px;
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid transparent;
        }

        .task-checkbox { display: none; } /* Hide default checkbox */

        /* Visual Feedback Logic */
        .task-checkbox:checked + .task-card {
            background: #f0fdf4; /* Very light green */
            border-color: #86efac;
            transform: scale(1.02);
            box-shadow: var(--success-glow);
        }

        .task-checkbox:checked + .task-card .task-title {
            color: #15803d;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .task-checkbox:checked + .task-card .check-circle {
            background: #22c55e;
            border-color: #22c55e;
            transform: rotate(360deg);
        }

        .task-checkbox:checked + .task-card .check-circle::after {
            content: '\f00c';
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: white;
            font-size: 14px;
        }

        /* Check Circle Style */
        .check-circle {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
        }

        .task-content { flex: 1; }
        .task-title { font-weight: 700; font-size: 1rem; color: var(--text-main); transition: color 0.3s; }
        .task-desc { font-size: 0.8rem; color: var(--text-light); }
        .task-icon { margin-right: 10px; color: #94a3b8; width: 20px; text-align: center; }

        /* --- NEW SECTION: My Journey (Calendar) --- */
        .journey-section {
            margin-top: 40px;
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .journey-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .journey-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 5px;
        }

        .journey-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .journey-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(38px, 1fr));
            gap: 8px;
        }

        .day-card {
            aspect-ratio: 1;
            background: #f1f5f9;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: #94a3b8;
            transition: all 0.3s ease;
            position: relative;
        }

        /* Journey Card States - COLOR CODED */
        .day-card.perfect { background: #86efac; color: #064e3b; box-shadow: 0 2px 8px rgba(134, 239, 172, 0.4); } /* 100% */
        .day-card.good { background: #93c5fd; color: #1e3a8a; } /* 70-99% */
        .day-card.okay { background: #fcd34d; color: #78350f; } /* 30-69% */
        .day-card.low { background: #fca5a5; color: #7f1d1d; } /* 1-29% */
        
        .day-card.current {
            background: white;
            border: 2px solid #3b82f6;
            color: #3b82f6;
            transform: scale(1.05);
            z-index: 2;
        }

        .day-card.missed {
            background: #e2e8f0;
            color: #94a3b8;
            opacity: 0.6;
        }

        /* --- 3. Celebration Modal --- */
        #celebration-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        #celebration-overlay.active { opacity: 1; pointer-events: auto; }
        
        .celebration-content h2 {
            font-size: 2rem;
            color: #334155;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .celebration-content p {
            color: #64748b;
            text-align: center;
        }

        /* --- 4. Footer & Progress --- */
        .sticky-footer {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-top: 1px solid #f1f5f9;
            padding: 15px 20px 30px;
            z-index: 500;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Day Complete Button */
        .btn-complete-day {
            width: 100%;
            padding: 16px;
            background: var(--text-main);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 800;
            letter-spacing: 0.5px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(51, 65, 85, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-complete-day:active { transform: scale(0.97); }

        /* New Day Button */
        .btn-new-day {
            width: 100%;
            padding: 12px;
            background: #f1f5f9;
            color: var(--text-main);
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-new-day:hover {
            background: #e2e8f0;
            border-color: #94a3b8;
        }

        .btn-new-day:active { transform: scale(0.97); }
        
        /* Progress Bar */
        .progress-container { width: 100%; }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        .progress-track {
            width: 100%;
            height: 10px;
            background: #f1f5f9;
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #34d399, #3b82f6);
            border-radius: 20px;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Confetti Animation (CSS only representation) */
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .pop-anim { animation: pop 0.3s ease; }

        @media (min-width: 768px) {
            .app-container { margin-top: 40px; padding-bottom: 200px; }
            .sticky-footer { max-width: 600px; left: 50%; transform: translateX(-50%); border-radius: 20px 20px 0 0; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- HEADER -->
    <header>
        <div class="header-text">
            <h1>Reset Plan</h1>
            <div class="subtitle">Dopamine & Drive</div>
        </div>
        <div class="streak-badge">
            <i class="fa-solid fa-fire"></i> <span id="streak-display">Streak: 0</span>
        </div>
    </header>

    <!-- MORNING BLOCK -->
    <div class="time-block" id="block-morning">
        <div class="block-header header-morning">
            <span><i class="fa-regular fa-sun"></i> Morning</span>
            <div class="master-check-label" onclick="toggleBlock('morning')">
                <i class="fa-solid fa-check-double"></i> Check All
            </div>
        </div>
        <div class="task-list">
            <input type="checkbox" id="t1" class="task-checkbox" onchange="updateProgress()">
            <label for="t1" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-glass-water task-icon"></i>Wake + Water</div>
                    <div class="task-desc">Start the engine.</div>
                </div>
                <div class="check-circle"></div>
            </label>

            <input type="checkbox" id="t2" class="task-checkbox" onchange="updateProgress()">
            <label for="t2" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-capsules task-icon"></i>Vitamins</div>
                    <div class="task-desc">D3 • K2 • B12</div>
                </div>
                <div class="check-circle"></div>
            </label>
            
            <input type="checkbox" id="t3" class="task-checkbox" onchange="updateProgress()">
            <label for="t3" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-person-walking task-icon"></i>Movement</div>
                    <div class="task-desc">10m walk or stretch.</div>
                </div>
                <div class="check-circle"></div>
            </label>
        </div>
    </div>

    <!-- AFTERNOON BLOCK -->
    <div class="time-block" id="block-afternoon">
        <div class="block-header header-evening">
            <span><i class="fa-regular fa-clock"></i> Afternoon</span>
            <div class="master-check-label" onclick="toggleBlock('afternoon')">
                <i class="fa-solid fa-check-double"></i> Check All
            </div>
        </div>
        <div class="task-list">
            <input type="checkbox" id="t4" class="task-checkbox" onchange="updateProgress()">
            <label for="t4" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-bowl-food task-icon"></i>High Protein Lunch</div>
                    <div class="task-desc">Fuel focus.</div>
                </div>
                <div class="check-circle"></div>
            </label>

            <input type="checkbox" id="t5" class="task-checkbox" onchange="updateProgress()">
            <label for="t5" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-arrows-rotate task-icon"></i>Reset Break</div>
                    <div class="task-desc">Step away from screens.</div>
                </div>
                <div class="check-circle"></div>
            </label>
        </div>
    </div>

    <!-- EVENING BLOCK -->
    <div class="time-block" id="block-evening">
        <div class="block-header header-afternoon">
            <span><i class="fa-regular fa-moon"></i> Evening</span>
            <div class="master-check-label" onclick="toggleBlock('evening')">
                <i class="fa-solid fa-check-double"></i> Check All
            </div>
        </div>
        <div class="task-list">
            <input type="checkbox" id="t6" class="task-checkbox" onchange="updateProgress()">
            <label for="t6" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-carrot task-icon"></i>Clean Dinner</div>
                    <div class="task-desc">No sugar / No dairy.</div>
                </div>
                <div class="check-circle"></div>
            </label>

            <input type="checkbox" id="t7" class="task-checkbox" onchange="updateProgress()">
            <label for="t7" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-book task-icon"></i>Wind Down</div>
                    <div class="task-desc">Analog mode. No phones.</div>
                </div>
                <div class="check-circle"></div>
            </label>
        </div>
    </div>

    <!-- NIGHT BLOCK -->
    <div class="time-block" id="block-night">
        <div class="block-header header-night">
            <span><i class="fa-solid fa-bed"></i> Night</span>
            <div class="master-check-label" onclick="toggleBlock('night')">
                <i class="fa-solid fa-check-double"></i> Check All
            </div>
        </div>
        <div class="task-list">
            <input type="checkbox" id="t8" class="task-checkbox" onchange="updateProgress()">
            <label for="t8" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-tablets task-icon"></i>Magnesium</div>
                    <div class="task-desc">Deep sleep protocol.</div>
                </div>
                <div class="check-circle"></div>
            </label>

            <input type="checkbox" id="t9" class="task-checkbox" onchange="updateProgress()">
            <label for="t9" class="task-card">
                <div class="task-content">
                    <div class="task-title"><i class="fa-solid fa-moon task-icon"></i>Sleep</div>
                    <div class="task-desc">7-8 hours non-negotiable.</div>
                </div>
                <div class="check-circle"></div>
            </label>
        </div>
    </div>

    <!-- JOURNEY SECTION -->
    <section class="journey-section">
        <div class="journey-header">
            <div class="journey-title">Your nervous system is learning consistency.</div>
            <div class="journey-subtitle" id="journey-stats">Completed: 0 / 60 days</div>
        </div>
        <div class="journey-grid" id="journey-grid">
            <!-- Grid generated by JS -->
        </div>
    </section>

    <!-- CELEBRATION OVERLAY -->
    <div id="celebration-overlay">
        <div class="celebration-content">
            <i class="fa-solid fa-medal" style="font-size: 4rem; color: #fbbf24; margin-bottom: 20px;"></i>
            <h2>Amazing Work.</h2>
            <p>Your nervous system is healing.</p>
            <p style="margin-top: 20px; font-weight: bold; color: #334155;">Streak Updated!</p>
            <button onclick="closeOverlay()" style="margin-top: 30px; padding: 10px 25px; border: none; background: #334155; color: white; border-radius: 10px; cursor: pointer;">Close & Next Day</button>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="sticky-footer">
        <!-- Progress -->
        <div class="progress-container">
            <div class="progress-header">
                <span id="progress-text">Progress: 0%</span>
                <span>Level Up</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Day Complete Button -->
        <button class="btn-complete-day" onclick="completeDay()">
            FINISH DAY <i class="fa-solid fa-arrow-right" style="margin-left: 8px;"></i>
        </button>

        <!-- New Day Button -->
        <button class="btn-new-day" onclick="startNewDay()">
            <i class="fa-solid fa-calendar-day" style="margin-right: 8px;"></i>New Day
        </button>
    </footer>

</div>

<!-- Minimal Interaction Script -->
<script>
    // 1. Initialize State
    let streak = parseInt(localStorage.getItem('resetStreak')) || 0;
    // Track which days are "Done" (stores the Percentage 0-100)
    let completedDays = JSON.parse(localStorage.getItem('completedDays')) || []; 
    // Track the current active day (0 to 59)
    let currentDayIndex = parseInt(localStorage.getItem('currentDayIndex')) || 0; 
    
    // Limits
    const TOTAL_DAYS = 60;

    // Storage keys
    const STORAGE_KEYS = {
        CHECKBOXES: 'resetPlanCheckboxes',
        PROGRESS: 'resetPlanProgress',
        LAST_DATE: 'resetPlanLastDate'
    };

    // 2. Save checkbox states to localStorage
    function saveCheckboxStates() {
        const checkboxes = document.querySelectorAll('.task-checkbox');
        const checkboxStates = {};
        checkboxes.forEach(checkbox => {
            checkboxStates[checkbox.id] = checkbox.checked;
        });
        localStorage.setItem(STORAGE_KEYS.CHECKBOXES, JSON.stringify(checkboxStates));
    }

    // 3. Restore checkbox states from localStorage
    function restoreCheckboxStates() {
        const saved = localStorage.getItem(STORAGE_KEYS.CHECKBOXES);
        if (saved) {
            try {
                const checkboxStates = JSON.parse(saved);
                Object.keys(checkboxStates).forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = checkboxStates[id];
                    }
                });
            } catch (e) {
                console.error('Error restoring checkbox states:', e);
            }
        }
    }

    // 4. Save progress to localStorage
    function saveProgress() {
        const checkboxes = document.querySelectorAll('.task-checkbox');
        const checked = document.querySelectorAll('.task-checkbox:checked');
        const total = checkboxes.length;
        const count = checked.length;
        const percent = total === 0 ? 0 : Math.round((count / total) * 100);
        localStorage.setItem(STORAGE_KEYS.PROGRESS, percent.toString());
    }

    // 5. Restore progress from localStorage
    function restoreProgress() {
        const saved = localStorage.getItem(STORAGE_KEYS.PROGRESS);
        if (saved) {
            const percent = parseInt(saved);
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-text').innerText = `Progress: ${percent}%`;
        }
    }

    // 6. Check if it's a new day
    function isNewDay() {
        const today = new Date().toDateString();
        const lastDate = localStorage.getItem(STORAGE_KEYS.LAST_DATE);
        return lastDate !== today;
    }

    // 7. Update last active date
    function updateLastDate() {
        const today = new Date().toDateString();
        localStorage.setItem(STORAGE_KEYS.LAST_DATE, today);
    }

    // 8. Initialize on page load
    function initializeApp() {
        // Check if it's a new day - if so, reset checkboxes but keep history
        if (isNewDay()) {
            // Clear daily checkboxes but keep streak and completedDays
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(box => { box.checked = false; });
            saveCheckboxStates();
            saveProgress();
            updateLastDate();
        } else {
            // Restore saved states
            restoreCheckboxStates();
            restoreProgress();
        }
        
        // Always update progress display
        updateProgress();
    }

    // Display Streak
    document.getElementById('streak-display').innerText = `Streak: ${streak}`;

    // 2. Render Journey Grid
    function renderJourneyGrid() {
        const grid = document.getElementById('journey-grid');
        grid.innerHTML = ''; // Clear
        
        let completedCount = 0;

        for (let i = 0; i < TOTAL_DAYS; i++) {
            const dayNum = i + 1;
            const el = document.createElement('div');
            el.className = 'day-card';
            el.innerText = dayNum;

            const val = completedDays[i];
            
            // Handle backwards compatibility (if 'true' was stored)
            let percent = (val === true) ? 100 : val;

            if (percent !== undefined && percent !== null) {
                // Determine Color Class based on %
                if (percent === 100) {
                    el.classList.add('perfect');
                } else if (percent >= 70) {
                    el.classList.add('good');
                } else if (percent >= 30) {
                    el.classList.add('okay');
                } else if (percent > 0) {
                    el.classList.add('low');
                } else {
                    el.classList.add('missed'); // 0%
                }
                
                if (percent >= 30) completedCount++; // Count "good enough" days
            } else if (i === currentDayIndex) {
                el.classList.add('current');
            } else if (i < currentDayIndex) {
                // Past days not logged
                el.classList.add('missed');
            }

            grid.appendChild(el);
        }

        // Update Stats Text
        document.getElementById('journey-stats').innerText = `Logged: ${completedCount} / ${TOTAL_DAYS} days`;
    }

    // 3. Update Progress Bar Logic
    function updateProgress() {
        const checkboxes = document.querySelectorAll('.task-checkbox');
        const checked = document.querySelectorAll('.task-checkbox:checked');
        
        const total = checkboxes.length;
        const count = checked.length;
        const percent = total === 0 ? 0 : Math.round((count / total) * 100);

        // Update visual bar
        document.getElementById('progress-fill').style.width = percent + '%';
        document.getElementById('progress-text').innerText = `Progress: ${percent}%`;
        
        // Save progress and checkbox states immediately
        saveProgress();
        saveCheckboxStates();
    }

    // 4. Master Checkbox Logic (Auto-check block)
    function toggleBlock(blockName) {
        const block = document.getElementById(`block-${blockName}`);
        const inputs = block.querySelectorAll('input[type="checkbox"]');
        const allChecked = Array.from(inputs).every(input => input.checked);
        inputs.forEach(input => { input.checked = !allChecked; });
        updateProgress(); // This will save states automatically
    }

    // 5. Complete Day Logic (The Big Button)
    function completeDay() {
        const checkboxes = document.querySelectorAll('.task-checkbox');
        const checked = document.querySelectorAll('.task-checkbox:checked');
        
        // Calculate actual percentage done right now
        const total = checkboxes.length;
        const count = checked.length;
        const percent = total === 0 ? 0 : Math.round((count / total) * 100);

        // DO NOT auto-check unchecked boxes. 
        // We accept the user's truth.

        triggerCelebration(percent);
    }

    // 6. Celebration & Journey Logic
    function triggerCelebration(percent) {
        const overlay = document.getElementById('celebration-overlay');
        const title = overlay.querySelector('h2');
        const msg = overlay.querySelector('p');

        // Custom message based on effort
        if (percent === 100) {
            title.innerText = "Perfect Day!";
            msg.innerText = "Your nervous system is healing.";
        } else if (percent >= 70) {
            title.innerText = "Great Job!";
            msg.innerText = "Consistency over perfection.";
        } else if (percent > 0) {
            title.innerText = "Day Logged.";
            msg.innerText = "Every small step counts.";
        } else {
            title.innerText = "Rest Day?";
            msg.innerText = "Tomorrow is a new start.";
        }

        overlay.classList.add('active');

        // Logic: Mark today as done with the specific percentage
        if (completedDays[currentDayIndex] === undefined || completedDays[currentDayIndex] === null) {
            completedDays[currentDayIndex] = percent;
            
            // Streak Logic: Reset on 0%, Increment on >0%
            if (percent > 0) {
                streak++;
            } else {
                streak = 0;
            }
        }
        
        // Save
        localStorage.setItem('resetStreak', streak);
        localStorage.setItem('completedDays', JSON.stringify(completedDays));
        saveCheckboxStates(); // Save checkbox states
        saveProgress(); // Save progress
        
        // Update Streak UI
        document.getElementById('streak-display').innerText = `Streak: ${streak}`;
    }

    function closeOverlay() {
        const overlay = document.getElementById('celebration-overlay');
        overlay.classList.remove('active');
        
        setTimeout(() => {
            // Reset daily checkboxes
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(box => { box.checked = false; });
            saveCheckboxStates(); // Save reset state
            updateProgress();
            
            // Advance Day
            if(currentDayIndex < TOTAL_DAYS - 1) {
                currentDayIndex++;
                localStorage.setItem('currentDayIndex', currentDayIndex);
            }

            // Re-render Grid
            renderJourneyGrid();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }, 500); 
    }

    // 9. New Day Button Function
    function startNewDay() {
        if (confirm('Start a new day? This will reset your checkboxes but keep your streak and progress history.')) {
            // Reset only daily checkboxes
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(box => { box.checked = false; });
            
            // Save the reset state
            saveCheckboxStates();
            saveProgress();
            
            // Advance to next day
            if(currentDayIndex < TOTAL_DAYS - 1) {
                currentDayIndex++;
                localStorage.setItem('currentDayIndex', currentDayIndex);
            }
            
            // Update last date
            updateLastDate();
            
            // Update UI
            updateProgress();
            renderJourneyGrid();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // Run on load
    initializeApp();
    renderJourneyGrid();
</script>

</body>
</html>